# -*- coding: utf-8 -*-
import streamlit as st
from datetime import date

# ---------- åŠŸèƒ½å‡½æ•¸ ----------
def sum_digits(n):
    """å°‡æ•¸å­—æ¯ä½ç›¸åŠ """
    return sum(int(d) for d in str(n))

def calculate_life_number(year, month, day, query_year):
    # åˆ¤æ–·æŸ¥è©¢å¹´ä»½æ˜¯å¦åœ¨ç”Ÿæ—¥ä¹‹å‰
    birthday_this_year = date(query_year, month, day)
    today = date(query_year, 1, 1)  # åªæ¯”è¼ƒç•¶å¹´1/1èˆ‡ç”Ÿæ—¥
    if birthday_this_year > today:
        base_year = query_year - 1
    else:
        base_year = query_year

    # æµå¹´ç¸½å’Œ
    total_sum = base_year + month + day
    mid_sum = sum_digits(total_sum)
    main_number = sum_digits(mid_sum)

    return total_sum, mid_sum, main_number

def get_year_advice(main_number):
    advice_dict = {
        1: ("è‡ªä¸»èˆ‡çªç ´ä¹‹å¹´", "å®¹æ˜“è¡å‹•ã€å–®æ‰“ç¨é¬¥", "è†è½ä»–äººæ„è¦‹ï¼Œæ±ºç­–å‰å…ˆå¯©æ…è©•ä¼°", "â­â­â­â­", "ç´…è‰²/æ©™è‰²", "è™çœ¼çŸ³"),
        2: ("å”ä½œèˆ‡é—œä¿‚ä¹‹å¹´", "å®¹æ˜“éæ–¼è¿åˆä»–äººï¼Œå¿½ç•¥è‡ªæˆ‘éœ€æ±‚", "æ˜ç¢ºè¡¨é”éœ€æ±‚ï¼Œå»ºç«‹å¥åº·é‚Šç•Œ", "â­â­â­", "ç¶ è‰²/ç²‰è‰²", "ç²‰æ™¶"),
        3: ("å‰µæ„èˆ‡è¡¨é”ä¹‹å¹´", "æƒ…ç·’æ³¢å‹•ã€åˆ†å¿ƒæˆ–éåº¦ç¤¾äº¤", "å°ˆæ³¨æ ¸å¿ƒç›®æ¨™ï¼Œè¦åŠƒæ™‚é–“çµ¦å‰µæ„ç™¼æƒ³", "â­â­â­â­", "é»ƒè‰²/ç´«è‰²", "ç´«æ°´æ™¶"),
        4: ("ç©©å®šèˆ‡åŸºç¤ä¹‹å¹´", "æ„Ÿåˆ°å£“åŠ›æ²‰é‡æˆ–æ‹˜æ³¥å½¢å¼", "å»ºç«‹æœ‰å½ˆæ€§çš„è¨ˆç•«ï¼Œé¿å…éåº¦è¿½æ±‚å®Œç¾", "â­â­â­", "æ£•è‰²/å¤§åœ°è‰²", "èˆ’ä¿±å¾ "),
        5: ("è®Šå‹•èˆ‡è‡ªç”±ä¹‹å¹´", "æ˜“ç„¦æ…®ã€ç¼ºä¹è€å¿ƒ", "ä¿æŒéˆæ´»å¿ƒæ…‹ï¼Œå–„ç”¨è®ŠåŒ–å¸¶ä¾†çš„å­¸ç¿’æ©Ÿæœƒ", "â­â­â­â­", "è—è‰²/ç°è‰²", "æ‹‰é•·çŸ³"),
        6: ("é—œæ‡·èˆ‡è²¬ä»»ä¹‹å¹´", "æ‰¿æ“”éå¤šï¼Œå®¹æ˜“å¿½ç•¥è‡ªæˆ‘", "è¨­å®šåˆç†ç•Œé™ï¼Œå…¼é¡§è‡ªæˆ‘èˆ‡é—œæ‡·ä»–äºº", "â­â­â­", "ç²‰è‰²/ç¶ è‰²", "ç¶ å¹½éˆ"),
        7: ("å…§çœèˆ‡å­¸ç¿’ä¹‹å¹´", "å®¹æ˜“å­¤ç«‹è‡ªå·±æˆ–é™·å…¥éåº¦æ€è€ƒ", "å®šæœŸèˆ‡ä¿¡ä»»çš„äººåˆ†äº«æƒ³æ³•ï¼Œä¿æŒå¹³è¡¡", "â­â­â­", "è—è‰²/ç´«è‰²", "é’é‡‘çŸ³"),
        8: ("äº‹æ¥­èˆ‡è²¡å‹™ä¹‹å¹´", "å¿™æ–¼è¿½æ±‚æˆå°±ï¼Œå¿½ç•¥æƒ…æ„Ÿæˆ–å¥åº·", "èª¿æ•´ç¯€å¥ï¼Œå‡è¡¡ç‰©è³ªèˆ‡å…§åœ¨éœ€æ±‚", "â­â­â­â­", "é‡‘è‰²/é»ƒè‰²", "é»ƒæ°´æ™¶"),
        9: ("æ”¶å°¾èˆ‡é‡‹æ”¾ä¹‹å¹´", "æŠµæŠ—æ”¹è®Šï¼Œå®¹æ˜“é™·å…¥æƒ…ç·’å›é¡§", "ç·´ç¿’æ”¾æ‰‹èˆ‡æ„Ÿæ©ï¼Œç‚ºæ–°éšæ®µç•™å‡ºç©ºé–“", "â­â­â­", "ç™½è‰²/éŠ€è‰²", "æœˆå…‰çŸ³"),
    }
    return advice_dict.get(main_number, ("æœªçŸ¥å¹´ä»½", "", "", "â­", "ç™½è‰²", "ç™½æ°´æ™¶"))

# ---------- Streamlit ä»‹é¢ ----------
st.set_page_config(page_title="æµå¹´ç”Ÿå‘½éˆæ•¸è¨ˆç®—å™¨", layout="centered")
st.title("ğŸŒŸ ç”Ÿå‘½éˆæ•¸æµå¹´è¨ˆç®—å™¨")
st.markdown("è¼¸å…¥ä½ çš„ç”Ÿæ—¥èˆ‡æŸ¥è©¢å¹´ä»½ï¼Œå³å¯ç²å¾—å€‹äººåŒ–æµå¹´æŒ‡å¼•èˆ‡å»ºè­°ã€‚")

# è¼¸å…¥
birth_input = st.text_input("è«‹è¼¸å…¥ç”Ÿæ—¥ (YYYY/MM/DD)", "1979/12/03")
query_year = st.number_input("è«‹è¼¸å…¥æŸ¥è©¢å¹´ä»½", min_value=1900, max_value=2100, value=2025)

if st.button("è¨ˆç®—æµå¹´"):
    try:
        year, month, day = map(int, birth_input.split("/"))
        total_sum, mid_sum, main_number = calculate_life_number(year, month, day, query_year)
        year_title, challenge, action, stars, lucky_color, crystal = get_year_advice(main_number)

        st.markdown("### ğŸ“Š æµå¹´çµæœ")
        st.write(f"**æµå¹´çµ„åˆæ•¸ï¼š** {total_sum} / {mid_sum} / {main_number}")
        st.write(f"**ä¸»æ•¸æµå¹´ä¸»é¡Œï¼š** {year_title}")
        st.write(f"**å¹´åº¦é‹å‹¢æŒ‡æ•¸ï¼š** {stars}")
        st.write(f"**å¯èƒ½æŒ‘æˆ°ï¼š** {challenge}")
        st.write(f"**å»ºè­°è¡Œå‹•ï¼š** {action}")
        st.write(f"**å¹¸é‹é¡è‰²ï¼š** {lucky_color}")
        st.write(f"**å»ºè­°æ°´æ™¶ï¼š** {crystal}")

    except Exception as e:
        st.error("è«‹ç¢ºèªç”Ÿæ—¥æ ¼å¼æ­£ç¢ºï¼Œä¾‹å¦‚ï¼š1979/12/03")
